generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String    @id @default(uuid())
  name          String?
  email         String?   @unique
  password      String?
  emailVerified DateTime?
  image         String?
  role          Role      @default(APPLICANT)
  gender        Gender    @default(OTHER)
  
  accounts      Account[]
  sessions      Session[]
  
  // Relations
  applicant     Applicant?
  recruiter     Recruiter?
  applications  InternshipApplication[]
}

model Applicant {
  id                String   @id @default(uuid())
  userId            String   @unique
  linkedInLink      String?
  resumeLink        String?
  githubLink        String?
  leetcodeLink      String?
  codeforcesLink    String?
  portfolioLink     String?
  about             String?
  skills            String[]
  projects          String[] // Stores simple string list
  education         Json?
  rawResumeText     String?
  resumeProjectText String?
  experience        Json?
  phoneNumber       String[]
  
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Relation Fields (Renamed to camelCase for better client usage)
  projectModels     Project[] 
  verifiedSkills    VerifiedSkill[]
}

model Recruiter {
  id           String       @id @default(uuid())
  userId       String       @unique
  companyId    String?
  position     String?
  website      String?
  contactEmail String?
  about        String?
  
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  company      Company?     @relation(fields: [companyId], references: [id])
  internships  Internship[]
}

model Company {
  id              String   @id @default(uuid())
  name            String
  industry        String?
  website         String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  companySize     String?
  establishedYear Int?
  location        String?
  overview        String?

  internships     Internship[]
  recruiters      Recruiter[]
  companyAuth     CompanyAuth?
}

model CompanyAuth {
  id        String  @id @default(uuid())
  companyId String  @unique
  loginId   String  @unique
  password  String
  
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
}

model Internship {
  id                  String              @id @default(uuid())
  category            InternshipCategory?
  title               String
  slug                String              @unique
  description         String
  location            String
  type                InternshipType      @default(ONSITE)
  mode                InternshipMode      @default(FULL_TIME)
  stipend             Int?
  stipendType         StipendType?
  durationWeeks       Int?
  openings            Int?
  skillsRequired      String[]
  perks               String[]
  eligibility         String?
  userType            UserType?
  startDate           DateTime?
  applicationDeadline DateTime?
  isActive            Boolean             @default(true)
  status              InternshipStatus    @default(DRAFT)
  viewsCount          Int                 @default(0)
  applicationsCount   Int                 @default(0)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  
  companyId           String
  recruiterId         String
  question            String[]

  // Relations (Added onDelete Cascade to prevent orphans)
  company             Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  recruiter           Recruiter           @relation(fields: [recruiterId], references: [id], onDelete: Cascade)
  applications        InternshipApplication[]

  @@index([companyId])
  @@index([status])
  @@index([title])
}

model InternshipApplication {
  id                String            @id @default(uuid())
  internshipId      String
  applicantId       String
  
  coverLetter       String?
  resumeUrl         String?
  status            ApplicationStatus @default(Applied)
  createdAt         DateTime          @default(now())
  
  interviewDate     String?
  interviewLocation String?
  interviewMode     InterviewMode?    @default(online)
  interviewTime     String?
  
  isApplied         Boolean?          @default(true)
  isHire            Boolean?
  isReject          Boolean?
  isShortlisted     Boolean?
  resumeData        Json?
  selectInterview   Boolean?
  
  gender            Gender            @default(OTHER) 

  // Relations
  applicant         User              @relation(fields: [applicantId], references: [id], onDelete: Cascade)
  internship        Internship        @relation(fields: [internshipId], references: [id], onDelete: Cascade)

  @@unique([internshipId, applicantId])
  @@index([internshipId])
  @@index([applicantId])
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @id @default(uuid())
  expires    DateTime
}

model Project {
  id               String    @id @default(uuid())
  title            String
  description      String?
  githubUrl        String?
  projectLevel     String?
  analysis         String?
  codeQualityScore Float?
  applicantId      String
  
  // Renamed field to 'applicant' (lowercase) for convention
  applicant        Applicant @relation(fields: [applicantId], references: [id], onDelete: Cascade)
}

model VerifiedSkill {
  id                  String    @id @default(uuid())
  skillName           String
  skillNameNormalized String
  masteryLevel        Float
  applicantId         String
  
  // Renamed field to 'applicant' (lowercase) for convention
  applicant           Applicant @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  @@unique([applicantId, skillNameNormalized])
}

// Enums

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Role {
  APPLICANT
  RECRUITER
}

enum InternshipCategory {
  ENGINEERING
  DESIGN
  MARKETING
  SALES
  FINANCE
  HUMAN_RESOURCES
  OPERATIONS
  CONTENT_WRITING
  PRODUCT_MANAGEMENT
  DATA_SCIENCE
  OTHER
  SOFTWARE_DEVLOPMENT 
}

enum InternshipType {
  ONSITE
  REMOTE
  HYBRID
}

enum InternshipMode {
  FULL_TIME
  PART_TIME
}

enum UserType {
  STUDENT
  GRADUATE
  PROFESSIONAL
  COMPANY
  ADMIN
}

enum InternshipStatus {
  DRAFT
  PUBLISHED
  CLOSED
  ARCHIVED
}

enum ApplicationStatus {
  Applied
  Shortlisted
  Interview
  Hire
  Reject
}

enum StipendType { // Fixed casing
  PAID
  UNPAID
  PB
  FIXED
}

enum InterviewMode {
  online
  offline
}